# Let's track ***Transaction***.

## Transaction概要
トランザクション(transaction)とは日本語では取引、処理、議事録等という意味ですが、<br>
IT業界ではコンピュータシステムにおける、データに対する一連の処理のことを指します。<br>
MySQL等のデータベース管理ツールはこの一連の処理の適応や破棄を管理してくれます。

## ACID特性
信頼性のあるトランザクションの持つべき性質として定義した概念です。
* **A**-tomicity　原子性<br>
トランザクションは完全適応か完全破棄かのどちらかになるので<br>
トランザクションは今以上に分離することができない単位になります。

* **C**-onsistency 一貫性<br>
トランザクション実行前と後でデータに矛盾がなく整合性がと持たれている事を示します。

* **I**-solation　分離性<br>
トランザクションは互いに干渉しないということです。<br>
分離性には後述しますがレベルがあります。

* **D**-urability 永続性<br>
トランザクションが完了するとその結果は永続的になります。<br>

## 分離性における問題
トランザクションが干渉しあった場合の問題の種類です。<br>
これらは分離性のレベルによって発生する問題が違います。

* Dirty Read<br>
トランザクション1でコミットされていないデータをトランザクション2で読みとってしまう。<br>

  * 問題点<br>
  アイテム取得の際のトランザクションが破棄された場合<br>
  読み取りのタイミングによってアイテムが増加していることになってしまう。

  * アプリケーションでの解決策<br>
  データ処理を並列で行わない。

* Fuzzy Read / Non-Repeatable Read<br>
トランザクション1でデータを複数回読み取っている途中で、<br>
トランザクション2でデータを***変更***しコミットした場合<br>
トランザクション1で変更後の値を読み取ってしまう。<br>

  * 問題点<br>
  HPの割合ダメージなどを与える際に後のトランザクションでHPが先に書き換わった場合<br>与えるダメージが変わってしまう。

  * アプリケーションでの解決策<br>
  アプリケーション側で保持しているHPを用いてダメージを与える。

* Phantom Read<br>
トランザクション1でデータを複数回読み取っている途中で、<br>
トランザクション2でデータを***追加または削除***しコミットした場合<br>
トランザクション1で追加または削除後の状態を読み取ってしまう。<br>


  * 問題点<br>
  現在取得しているユニットの数までアイテムがもらえる際に<br>
  後のトランザクションでユニットが増えた場合与えられるアイテムの数が変わってしまう。

  * アプリケーションでの解決策<br>
  ユニットの取得時間などを確認する。

## トランザクション分離レベル

分離レベルの種類は4つあり<br>
発生する問題と対応する<br>

|分離Level|Dirty Read|Fuzzy Read|Phantom Read|
|:--|:-:|:-:|:-:|
|READ UNCOMMITTED|○|○|○|
|READ COMMITTED|x|○|○|
|REPEATABLE READ|x|x|○|
|SERIALIZABLE|x|x|x|
  
